(function ($) {

	var $ancienTaux;
	var $nouveauTaux; 
	var $notif_final = $('#notification_exploi_final');
	var $notif = $('#notification_exploi'); 
	var $typeModif;

	/*$(document).ready(
			function() {

				$.ajax({
					url:"cumulfrais",
					type:'GET',
					datatype:'json',
					contentType:'application/json',
					success: function(data){
						console.log(data);


					}
				});

	 */



	$('body').on('click', '#form-exploi-calculretro',function(e){
		e.preventDefault();
		$typeModif = "cr";

		$('#confirmation-modal').show();
		$('.modal-backdrop').show();


		$('#confirmation-modal').modal({
			keyboard : false,
			backdrop : 'static',
			width : 300
		});
	});


	$('body').on('click', '#form-exploi-save',function(e){
		e.preventDefault();

		$typeModif = "sv";
		$('#confirmation-modal').show();
		$('.modal-backdrop').show();


		$('#confirmation-modal').modal({
			keyboard : false,
			backdrop : 'static',
			width : 300
		});
	});

	$('body').on('click', '#form-exploi-oui',function(e){
		e.preventDefault();
		$notif.removeClass('alert alert-danger');
		$notif.text('');

		$ancienTaux = parseInt($('#form-exploi-ancientaux').val());
		console.log("$ancienTaux= "+$ancienTaux);

		$nouveauTaux = parseInt($('#form-exploi-nveautaux').val());
		console.log("$nouveauTaux= "+$nouveauTaux);

		if($ancienTaux <=0 ){
			$notif.addClass('alert alert-danger');
			$notif.text('Revoir la saisie de l ancien taux');
		}else if($nouveauTaux <= 0){
			$notif.addClass('alert alert-danger');
			$notif.text('Revoir la saisie du nouveau taux');
		}else{

			$csrf = $('input[name="_csrf"]').val();
			calculretro = "ancienTaux="+$ancienTaux+"&nouveauTaux="+$nouveauTaux+"&_csrf=" + $csrf + "";

			$('#load_modiftaux').css({'display':'inline-block'});
			$('#load_modiftaux_icone').css({'display':'inline-block'});


			if($typeModif === "sv"){
				$.ajax({
					url:"onlysavenouveautaux",
					type:'POST',
					data: calculretro,
					success: function(data){
						$('#load_modiftaux').fadeOut();
						$('#load_modiftaux_icone').fadeOut();

						if(data===0){
							$('#notification_exploi_final').css({'display':'block'});
							$('#form-exploi-ancientaux').val(''+$nouveauTaux+'')
							$('#form-exploi-nveautaux').val(''+0+'')

						}else if(data===1){
							$notif.addClass('alert alert-danger');
							$notif.text('revoir la saisie du nouveau taux'); 
						}
					},
					error: function (xhr, textStatus, errorThrown) {
						$('#load_modiftaux').fadeOut();
						$('#load_modiftaux_icone').fadeOut();
						$notif.addClass('alert alert-danger');
						$notif.text('La communication avec le serveur a echoué. Veuillez informer le service de développement. \n Erreur: '+(errorThrown ? errorThrown : xhr.status)); 
					}
				}); 

			}else if($typeModif === "cr"){
				$.ajax({
					url:"calculandsavenouveautaux",
					type:'POST',
					data: calculretro,
					success: function(data){
						$('#load_modiftaux').fadeOut();
						$('#load_modiftaux_icone').fadeOut();

						if(data===1){
							$notif.addClass('alert alert-danger');
							$notif.text('revoir la saisie'); 

						}else{
							$('#notification_exploi_final').css({'display':'block'});
							$('#form-exploi-cumul').val(''+data+'');
							$('#form-exploi-ancientaux').val(''+$nouveauTaux+'')
							$('#form-exploi-nveautaux').val(''+0+'')


						}
					},
					error: function (xhr, textStatus, errorThrown) {
						$('#load_modiftaux').fadeOut();
						$('#load_modiftaux_icone').fadeOut();
						$notif.addClass('alert alert-danger');
						$notif.text('La communication avec le serveur a echoué. Veuillez informer le service de développement. \n Erreur: '+(errorThrown ? errorThrown : xhr.status)); 
					}
				}); 
			}
	}

	});




	$('body').on('click', '#notification_exploi_final_close',function(e){
		e.preventDefault();
		$('#notification_exploi_final').css({'display':'none'});
	});
})(jQuery);