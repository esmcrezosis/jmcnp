<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="layout/admin">

<head>
    <title>Fiche ODD</title>
    <th:block th:fragment="style" th:remove="tag">
        <!--<link rel="stylesheet" th:href="@{/resources/js/jqgrid/ui.jqgrid.css}">-->
        <link rel="stylesheet" th:href="@{/resources/js/jqgrid/ui.jqgrid-bootstrap4.css}">
        <link rel="stylesheet" th:href="@{/resources/plugins/toastr/toastr.min.css}" />
    </th:block>
</head>

<body>
    <ul class="breadcrumb" layout:fragment="breadcrumb">
        <li><i class="ace-icon fa fa-home home-icon"></i> <a th:href="@{/}">Accueil</a></li>
        <li class="active">ODD</li>
    </ul>
    <th:block layout:fragment="topbar" th:remove="tag">
        <div th:include="oi/menu :: topnav" th:remove="tag" />
    </th:block>
    <!-- /.breadcrumb -->
    <div layout:fragment="content">
        <section class="section card mt-4">
            <!-- /widget-header -->
            <div class="card-body">
                <div class="form-header">
                    <h4 class="card-title">Bon de Consommation Récurrent Illimité (BCri)
                    </h4>
                </div>
                <div class="row">
                    <div class="col-lg-12">
                        <div class="md-form">
                            <input id="codeMembre" class="form-control" th:value="${codeMembre}" readonly="readonly" />
                            <label for="codeMembre" class="active">Code Membre</label>
                        </div>
                    </div>
                </div>
                <div class="btn-group" role="group" aria-label="Vertical button group">
                    <button type="button" id="btnEditFiche" class="btn btn-blue  btn-lg btn-md btn-sm ">
                        <span class="fas fa-list"></span>
                    </button>
                </div>
                <table id="bcriGrid">
                </table>
            </div>
        </section>
    </div>
    <th:block layout:fragment="script" th:remove="tag">
        <script th:src="@{/resources/plugins/toastr/toastr.min.js}"></script>
        <script th:src="@{/resources/js/jqgrid/grid.locale-fr.js}"></script>
        <script th:src="@{/resources/js/jqgrid/jquery.jqGrid.min.js}"></script>
        <script type="text/javascript" th:inline="javascript">
            var contextRoot = /*[[@{/}]]*/
            $(document)
                .ready(
                    function() {
                        "use strict";
                        var bcriGrid = $("#bcriGrid");
                        bcriGrid.jqGrid({
                            url: contextRoot + 'cm/listeCredits',
                            datatype: 'json',
                            mtype: 'GET',
                            styleUI: 'Bootstrap4',
                            postData: {
                                codeMembre: function() {
                                    return $('#codeMembre').val();
                                },
                                typeRecurrent: 'illimite'
                            },
                            colNames: ['ID', 'Date', 'Code', 'Debut', 'Fin', 'MSBC', 'MBC'],
                            colModel: [{
                                name: 'idCredit',
                                index: 'idCredit',
                                width: 70
                            }, {
                                name: 'dateOctroi',
                                index: 'dateOctroi',
                                width: 70
                            }, {
                                name: 'codeMembre',
                                index: 'codeMembre',
                                width: 200
                            }, {
                                name: 'datedeb',
                                index: 'datedeb',
                                width: 200
                            }, {
                                name: 'datefin',
                                index: 'datefin',
                                width: 200
                            }, {
                                name: 'montantPlace',
                                index: 'montantPlace',
                                width: 100
                            }, {
                                name: 'montantCredit',
                                index: 'montantCredit',
                                width: 100
                            }],
                            page: 1,
                            cmTemplate: {
                                autoResizable: true
                            },
                            autowidth: true,
                            height: 270,
                            iconSet: "fontAwesome",
                            sortname: "idCredit",
                            threeStateSort: true,
                            sortIconsBeforeText: true,
                            headertitles: true,
                            pager: true,
                            multiselect: false,
                            toppager: true,
                            rowNum: 10
                        });

                        $('#btnEditFiche').click(function(e) {
                            e.preventDefault();
                            var rowKey = ficheGrid.jqGrid('getGridParam', "selrow");
                            if (rowKey) {
                                var data = ficheGrid.jqGrid('getRowData', rowKey);
                                location.href = "/edit";
                            } else {
                                $(document).Toasts('create', {
                                    class: 'bg-info',
                                    title: 'Erreur de Sélection',
                                    autohide: true,
                                    delay: 2000,
                                    body: 'Aucune ligne sélectionnée'
                                });
                            }
                        });
                    });
        </script>
    </th:block>
</body>

</html>