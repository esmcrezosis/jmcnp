<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorator="layout/admin">

<head>
    <meta charset="UTF-8" />
    <title>Etat des BAn</title>
    <th:block th:fragment="style" th:remove="tag">
        <!--<link rel="stylesheet" th:href="@{/resources/js/jqgrid/ui.jqgrid.css}">-->
        <link rel="stylesheet" th:href="@{/resources/js/jqgrid/ui.jqgrid-bootstrap4.css}">
        <link rel="stylesheet" th:href="@{/resources/js/jqgrid/ui.jqgrid-bootstrap-ui.css}">
        <style type="text/css">
            input[type='checkbox'],
            input[type='checkbox']:checked,
            input[type='checkbox']:not(:checked) {
                display: inline-block;
                position: relative;
                pointer-events: auto;
                opacity: 1;
            }
        </style>
    </th:block>
</head>

<body>
    <ul class="breadcrumb" layout:fragment="breadcrumb">
        <li><i class="ace-icon fa fa-home home-icon"></i> <a th:href="@{/}">Accueil</a></li>
        <li class="active">Etat BAn</li>
    </ul>
    <!-- /.breadcrumb -->
    <th:block layout:fragment="topbar">
        <div th:if="${agr == 'OI'}" th:include="oi/menu :: topnav" th:remove="tag"></div>
        <div th:if="${agr == 'OKSU'}" th:include="oksu/menu :: topnav" th:remove="tag"></div>
        <div th:if="${agr == 'OBPS'}" th:include="obps/menu :: topnav" th:remove="tag"></div>
        <div th:if="${agr == 'OBPSD'}" th:include="obpsd/menu :: topnav" th:remove="tag"></div>
        <div th:if="${agr == 'OP'}" th:include="op/menu :: topnav" th:remove="tag"></div>
        <div th:if="${agr == 'OT'}" th:include="ot/menu" th:remove="tag"></div>
    </th:block>
    <div layout:fragment="content" class="mt-1">
        <div class=" card">
            <div class="container">
                <div class="row">
                    <div class="md-form col-lg-4">
                        <div class="input-group">
                            <input type="text" id="codeMembreBan" class="form-control" th:value="${codeMembre}">
                            <div class="input-group-append">
                                <button class="btn btn-md btn-sm btn-secondary" type="button" id="btnQrCodeMembre">
                                    QR Code
                                </button>
                            </div>
                            <label for="codeMembreBan">Code Membre</label>
                        </div>
                    </div>
                    <div class="md-form col-lg-4">
                        <input type="text" id="nomMembreBan" class="form-control">
                        <label for="nomMembreBan">Nom Membre</label>
                    </div>
                    <div class="md-form col-lg-4">
                        <input type="text" id="prenomMembreBan" class="form-control">
                        <label for="prenomMembreBan">Prenoms Membre</label>
                    </div>
                </div>
                <div class="row">
                    <div class="md-form col-lg-4" style="margin-top: 11px;">
                        <select type="text" id="typeBan" class="mdb-select">
                        <option value="" selected>Choisir le Type BAn</option>
                        <option value="BAn">Banque</option>
                        <option value="OPI">OPI</option>
                        <option value="ELI">ELI</option>
                    </select>
                        <label class="mdb-main-label" for="typeBan">Code Membre</label>
                    </div>
                    <div class="md-form col-lg-4">
                        <input type="text" id="dateDebutBan" class="form-control" data-inputmask-alias="datetime" data-inputmask-inputformat="dd/mm/yyyy" data-inputmask-placeholder="jj/mm/aaaa">
                        <label for="dateDebutBan" class="active">Date Debut</label>
                    </div>
                    <div class="md-form col-lg-4">
                        <div class="input-group">
                            <input type="text" id="dateFinBan" class="form-control" data-inputmask-alias="datetime" data-inputmask-inputformat="dd/mm/yyyy" data-inputmask-placeholder="jj/mm/aaaa">
                            <div class="input-group-append">
                                <button class="btn btn-md btn-sm btn-secondary" type="button" id="btnSearchBan">
                                Rechercher
                            </button>
                            </div>
                        </div>
                        <label for="dateFinBan" class="active">Date Fin</label>
                    </div>
                </div>
            </div>
        </div>

        <div class="card" style="margin-top: 5px;">
            <div class="card-header">
                <div class="float-left align-middle">
                    <button id="btnExportBan" type="button" class="btn btn-sm btn-default">Export</button>
                    <button id="btnEditBan" type="button" class="btn btn-sm btn-blue-grey">Editer</button>
                </div>
                <h5 class="card-title align-middle">Etat des BAn</h5>
            </div>
            <div class="card-body">
                <table id="tblBan"></table>
                <!-- Pagination Bar -->
                <div id="banPager"></div>
            </div>
        </div>
    </div>
    <th:block layout:fragment="script" th:remove="tag">
        <script th:src="@{/resources/js/inputmask/jquery.inputmask.min.js}"></script>
        <script th:src="@{/resources/js/jqgrid/grid.locale-fr.js}"></script>
        <script th:src="@{/resources/js/jqgrid/jquery.jqGrid.min.js}"></script>
        <script th:inline="javascript">
            var contextRoot = /*[[@{/}]]*/ ;
            var agr = /*[[${agr}]]*/ ;
            $(function() {
                $(":input").inputmask();

                var banTable = $("#tblBan");
                banTable.jqGrid({
                    url: contextRoot + 'bonNeutre/bans/',
                    mtype: "GET",
                    styleUI: 'Bootstrap4',
                    iconSet: "fontAwesome",
                    postData: {
                        codeMembre: function() {
                            return $("#codeMembreBan").val();
                        },
                        nomMembre: function() {
                            return $("#nomMembreBan").val();
                        },
                        prenomMembre: function() {
                            return $("#prenomMembreBan").val();
                        },
                        typeBan: function() {
                            return $("#typeBan").val();
                        },
                        deb: function() {
                            return $("input#dateDebutBan").val();
                        },
                        fin: function() {
                            return $("input#dateFinBan").val();
                        }
                    },
                    datatype: "json",
                    colModel: [{
                        label: 'ID',
                        name: 'bonNeutreId',
                        key: true,
                        width: 50,
                        hidden: true
                    }, {
                        label: 'Date',
                        name: 'bonNeutreDate',
                        width: 100
                    }, {
                        label: 'Code Membre',
                        name: 'bonNeutreCodeMembre',
                        width: 140
                    }, {
                        label: 'Nom Membre',
                        name: 'bonNeutreNom',
                        width: 150
                    }, {
                        label: 'Prenom Membre',
                        name: 'bonNeutrePrenom',
                        width: 150
                    }, {
                        label: 'Raison Sociale',
                        name: 'bonNeutreRaison',
                        width: 180
                    }, {
                        label: 'Montant',
                        name: 'bonNeutreMontant',
                        width: 100
                    }, {
                        label: 'Montant Utilise',
                        name: 'bonNeutreMontantUtilise',
                        width: 100
                    }, {
                        label: 'Solde',
                        name: 'bonNeutreMontantSolde',
                        width: 100
                    }, {
                        label: 'Type BAn',
                        name: 'bonNeutreType',
                        width: 100
                    }],
                    page: 1,
                    autowidth: true,
                    height: 400,
                    rowNum: 100,
                    rowList: [100, 250, 500],
                    rownumWidth: 25,
                    sortname: 'bonNeutreCodeMembre',
                    multiselect: false,
                    viewrecords: true,
                    emptyrecords: 'Pas de lignes trouvees', // the message will be displayed at the bottom
                    pager: "#banPager"
                });

                $("#btnEditBan").click(function(e) {
                    e.preventDefault();
                    var id = banTable.jqGrid('getGridParam', 'selrow');
                    if (id) {
                        var data = banTable.jqGrid('getRowData', id);
                        location.replace(contextRoot + "bonNeutre/" + agr + "/detail/" + data.bonNeutreId);
                    }
                });

                $("#btnSearchBan").click(function(e) {
                    e.preventDefault();
                    banTable.jqGrid().trigger('reloadGrid');
                });
            });
        </script>
    </th:block>
</body>

</html>